{layout name="layout"}

{extend name="layout"}
{block name="page_title"}
旅途
{/block}
{block name="content"}
<div id="lvtu">
    <div class="lvtu_lis">
        {volist name="journey" id="vo"}

            <input type="text"  hidden value="{$vo.uid}">
            <div class="lt-kk">
                <div class="lt-kk-1">
                    <div class="pic"><img src="{$vo.head_img}" width="90" height="90"></div>
                    <div class="tit">
                        <div class="tit-1"><b>{$vo.nickname}</b> | 职业{$vo.occupation_id}</div>
                        <div class="tit-2">{$vo.birthday}岁.12w.{$vo.address}</div>
                    </div>
                    <div class="gz">
                        {if condition = "$vo.attentioned eq 0"}
                        <a class="attention" value="{$vo.uid}">+  关注</a>
                        {else/}
                        <a value="{$vo.uid}" style="background-image: url(__HOME_CSS__/wapcssjsimg/images/ygz.png)">  已关注</a>
                        {/if}
                    </div>
                </div>
                    <div class="lt-kk-2">
                        <div class="info">
                            <a href="{:url('user/Journey/journey_detail',['id' => $vo['uid']])}">
                            <ul>
                                {if condition= "$vo.release_object  eq 1"}
                                <li>・邀约对象：男</li>
                                {elseif condition="$vo.release_object  eq 2"}
                                <li>・邀约对象：女</li>
                                {elseif condition="$vo.release_object  eq 0"}
                                <li>・邀约对象：不限</li>
                                {/if}
                                <li>・出行方式：{$vo.travel_tool}</li>
                                <li>・目的地：{$vo.travel_address}</li>
                                <li>・费&nbsp;&nbsp;&nbsp;&nbsp;用：100</li>
                            </ul>
                            <div class="date">{$vo.create_time|date='Y-m-d H:i:s',###}发布</div>
                            </a>
                        </div>
                        <div class="gxq"><a href=""><p>感兴趣</p></a></div>
                    </div>
            </div>

        {/volist}
    </div>

</div>

<h1>
    <input type="text" value="bbb" id="content" placeholder="输入聊天信息"/><button  id="send_info">发送</button>
    <br>
    <span id="receive_info">
        这里是接受的消息
    </span>
</h1>
{/block}

{block name="page_js"}
<script src="__HOME_JS__/user/journey/index.js"></script>

<script>
    var  c_id ;
   var  ws = new WebSocket("ws://127.0.0.1:8282");

    // 服务端主动推送消息时会触发这里的onmessage

    ws.onmessage = function(e){
        // json数据转换成js对象
        var bindUrl = "{:url('push/index/BindClientId')}";
        console.log(e.data);

        var data = eval("("+e.data+")");
        c_id = data.client_id;
        var type = data.type || '';
        switch(type){
            // Events.php中返回的init类型的消息，将client_id发给后台进行uid绑定
            case 'init':
                // 利用jquery发起ajax请求，将client_id发给后端进行uid绑定
                $.post(bindUrl, {client_id: data.client_id,message:$('#content').val()}, function(data){

                }, 'json');
                break;
            // 当mvc框架调用GatewayClient发消息时直接alert出来
            default :
                var text = e.data;
                var str = '<li style="width:100%; height:60px; border:1px solid #000">' +text +'</li>';
                $('#receive_info').append(str);
             //alert(e.data);
        }
    };

    $('#send_info').click(function(){
        var bindUrl = "{:url('push/index/AjaxSendMessage')}";
        $.post(bindUrl, {uid: 2,message:$('#content').val()}, function(data){

        }, 'json');
    })
</script>

{/block}

